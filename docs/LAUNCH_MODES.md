# 🚀 起動モードと実行方法

ClawBridge には用途に合わせた 3 つの起動方法があります。状況に応じて使い分けてください。

---

## 📋 起動モード比較

| コマンド | モード | ホットリロード | 起動速度 | 内容 |
| :--- | :--- | :--- | :--- | :--- |
| `./start.sh` | **Production** | ❌ なし | 🚀 最速 | サービス稼働用。ビルド済み UI を配信。 |
| `./dev.sh --fast` | **Preview** | ❌ なし | ✅ 速い | `start.sh` と同様だが、開発用ログを出力。 |
| `./dev.sh` | **Development** | ✅ あり | ⚠️ 遅め | 開発者用。UI の変更を即座に反映（Turbopack）。 |

---

## 🛠 各モードの詳細

### 1. `./start.sh` (本番・常用モード)
日常的にサーバーとして稼働させる場合に最適です。

- **動作:**
  1. 既存のポート（1337/1338）をクリーンアップ。
  2. `web/` の UI を事前にビルド (`npm run ui:build`)。
  3. `Node.js` サーバーをバックグラウンドまたはフォアグラウンドで起動。
- **特徴:**
  - ビルド済みの静的ファイル (`public/`) を配信するため、メモリ消費が少なく動作が非常に安定しています。
  - フロントエンドの変更を反映するには、再起動（再ビルド）が必要です。

### 2. `./dev.sh --fast` (高速プレビューモード)
「開発中の機能を確認したいが、ホットリロードの重さは避けたい」場合に最適です。

- **動作:**
  1. 既存のポート（1337/3000）をクリーンアップ。
  2. UI を一度だけビルド。
  3. バックエンドを起動し、ビルドした UI を配信。
- **特徴:**
  - 開発ログ (`DEBUG`) を出力しつつ、本番同様の速度でページを閲覧できます。
  - 起動時のオンデマンドコンパイルが発生しないため、ブラウザでの初回アクセスが高速です。

### 3. `./dev.sh` (開発・ホットリロードモード)
新機能の開発や、UI の微調整を行う場合に最適です。

- **動作:**
  1. **Next.js 開発サーバー (Turbo)** をポート 3000 で起動。
  2. バックエンド（ポート 1337）からポート 3000 へリクエストをプロキシ。
  3. 起動 5 秒後に **自動ウォームアップ (Auto-Warmup)** を実行し、事前にページをコンパイル。
- **特徴:**
  - `web/` フォルダ内のコードを編集すると、ブラウザをリロードせずに即座に反映されます。
  - 開発用プロキシを通すため、他のモードに比べると CPU/メモリの負荷が高くなります。

---

## 💡 トラブルシューティング

### 「Error occurred while trying to proxy」が出る
`./dev.sh` の起動途中でブラウザにアクセスすると発生することがあります。
- **解決策:** ターミナルに `[Warmup] Pages compiled successfully!` と表示されるまで数秒待ってからリロードしてください。

### ポートが既に使用されている
ClawBridge は起動時に `fuser -k` を使って自動的に古いプロセスを終了させますが、権限の問題で失敗することがあります。
- **解決策:** 手動でプロセスを終了するか、PC を再起動してください。
