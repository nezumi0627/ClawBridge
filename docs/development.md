# 👨‍💻 開発者ガイド

ClawBridge のメンテナンスや拡張を行う開発者のためのテクニカルメモです。

---

## 🏗️ 開発の進め方
ClawBridge は現在 **v0.3.0** の新アーキテクチャへの移行を完了しています。新機能の実装やバグ修正は、必ず `src/` ディレクトリ配下に対して行ってください。

### ディレクトリ役割
- `src/core/`: システムブートストラップ、共通の設定・ロギング。
- `src/api/`: Express ルートと、OpenAI 互換プロトコルのハンドラ。
- `src/services/`: コアロジック。ルーティングやツール補完などの複雑な処理。
- `src/providers/`: 外部 AI SDK/API との接続アダプタ。

---

## 🧪 デバッグ手法

### 環境変数による詳細ログ
起動時に以下の環境変数をセットすることで、プロバイダーからの生レスポンスや詳細な処理過程を出力できます。
```bash
DEBUG=1 node server.js
```

### Python バックエンド (G4F) の単体テスト
G4F の挙動が怪しい場合は、Node.js を介さずに直接起動して確認できます。
```bash
source gvenv/bin/activate
python3 g4f_server.py
```
デフォルトでは Port 1338 で ASGI サーバーが立ち上がります。

---

## 🔒 セキュリティと環境設定

### API キーの管理
- `config/settings.json` はローカルの設定を保持します。
- `settings.example.json` をテンプレートとして配布し、実際のキーが含まれるファイルは `.gitignore` で保護してください。
- 以下の環境変数によるキーの注入にも対応しています：
  - `GEMINI_API_KEY`
  - `GROQ_API_KEY`

### クッキー管理
`config/cookies/` 配下に JSON 形式でクッキーを配置することで、G4F が一部のプロバイダー（Gemini 等）の制限を回避できるように拡張可能です。

---

## ⚠️ レガシーコードへの対応
ルート直下の `providers/` や `handlers/` にあるファイルは、旧構成 (v0.2系) のコードです。
これらは現在 **使用されていません**。移植が完了した機能から順次削除、または `legacy/` ディレクトリへ移動される予定です。

---

[⬅️ ドキュメントセンターに戻る](./README.md)
